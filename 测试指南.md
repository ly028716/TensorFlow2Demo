# TensorFlow 2.0 å­¦ä¹ é¡¹ç›®æµ‹è¯•æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•è¿è¡Œå’Œç¼–å†™é¡¹ç›®çš„å•å…ƒæµ‹è¯•ã€‚

## ğŸ“‹ ç›®å½•

1. [æµ‹è¯•æ¦‚è¿°](#æµ‹è¯•æ¦‚è¿°)
2. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
3. [æµ‹è¯•ç»“æ„](#æµ‹è¯•ç»“æ„)
4. [è¿è¡Œæµ‹è¯•](#è¿è¡Œæµ‹è¯•)
5. [æµ‹è¯•è¦†ç›–ç‡](#æµ‹è¯•è¦†ç›–ç‡)
6. [ç¼–å†™æµ‹è¯•](#ç¼–å†™æµ‹è¯•)
7. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## ğŸ¯ æµ‹è¯•æ¦‚è¿°

æœ¬é¡¹ç›®åŒ…å«å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼Œè¦†ç›–ä»¥ä¸‹æ¨¡å—ï¼š

- âœ… **åŸºç¡€æ¨¡å—æµ‹è¯•** (test_01_basics.py)
  - å¼ é‡æ“ä½œã€å˜é‡ã€è‡ªåŠ¨å¾®åˆ†ç­‰

- âœ… **ç¥ç»ç½‘ç»œæµ‹è¯•** (test_02_neural_networks.py)
  - Keras APIã€ç½‘ç»œå±‚ã€æ¿€æ´»å‡½æ•°ç­‰

- âœ… **æ•°æ®å¤„ç†æµ‹è¯•** (test_03_data_processing.py)
  - tf.data APIã€æ•°æ®é¢„å¤„ç†ã€æ•°æ®å¢å¼ºç­‰

- âœ… **æ¨¡å‹è®­ç»ƒæµ‹è¯•** (test_04_model_training.py)
  - æ¨¡å‹ç¼–è¯‘ã€è®­ç»ƒã€è¯„ä¼°ã€ä¿å­˜åŠ è½½ç­‰

- âœ… **å·¥å…·å‡½æ•°æµ‹è¯•** (test_06_utils.py)
  - å¯è§†åŒ–å·¥å…·ã€å‚æ•°ç»Ÿè®¡ç­‰

- âœ… **é›†æˆæµ‹è¯•** (test_integration.py)
  - ç«¯åˆ°ç«¯å·¥ä½œæµç¨‹æµ‹è¯•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…æµ‹è¯•ä¾èµ–

```bash
# å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬æµ‹è¯•ä¾èµ–ï¼‰
pip install -r requirements.txt

# æˆ–å•ç‹¬å®‰è£…æµ‹è¯•å·¥å…·
pip install pytest pytest-cov coverage
```

### 2. è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# ä½¿ç”¨æµ‹è¯•è¿è¡Œè„šæœ¬ï¼ˆæ¨èï¼‰
python run_tests.py

# ä½¿ç”¨unittest
python -m unittest discover tests

# ä½¿ç”¨pytest
pytest
```

### 3. æŸ¥çœ‹æµ‹è¯•ç»“æœ

æµ‹è¯•è¿è¡Œåä¼šæ˜¾ç¤ºï¼š
- âœ… é€šè¿‡çš„æµ‹è¯•æ•°é‡
- âŒ å¤±è´¥çš„æµ‹è¯•æ•°é‡
- âš ï¸ é”™è¯¯çš„æµ‹è¯•æ•°é‡
- â­ï¸ è·³è¿‡çš„æµ‹è¯•æ•°é‡

## ğŸ“ æµ‹è¯•ç»“æ„

```
TensorFlow2Demo/
â”œâ”€â”€ tests/                          # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ __init__.py                 # æµ‹è¯•æ¨¡å—åˆå§‹åŒ–
â”‚   â”œâ”€â”€ test_01_basics.py           # åŸºç¡€æ¨¡å—æµ‹è¯•
â”‚   â”œâ”€â”€ test_02_neural_networks.py  # ç¥ç»ç½‘ç»œæµ‹è¯•
â”‚   â”œâ”€â”€ test_03_data_processing.py  # æ•°æ®å¤„ç†æµ‹è¯•
â”‚   â”œâ”€â”€ test_04_model_training.py   # æ¨¡å‹è®­ç»ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_06_utils.py            # å·¥å…·å‡½æ•°æµ‹è¯•
â”‚   â”œâ”€â”€ test_integration.py         # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ README.md                   # æµ‹è¯•æ–‡æ¡£
â”‚
â”œâ”€â”€ run_tests.py                    # æµ‹è¯•è¿è¡Œè„šæœ¬
â”œâ”€â”€ pytest.ini                      # Pytesté…ç½®
â”œâ”€â”€ .coveragerc                     # Coverageé…ç½®
â””â”€â”€ æµ‹è¯•æŒ‡å—.md                     # æœ¬æ–‡ä»¶
```

## ğŸ”§ è¿è¡Œæµ‹è¯•

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨æµ‹è¯•è¿è¡Œè„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python run_tests.py

# è¿è¡ŒæŒ‡å®šæ¨¡å—çš„æµ‹è¯•
python run_tests.py -m 01_basics
python run_tests.py -m 02_neural_networks
python run_tests.py -m 03_data_processing
python run_tests.py -m 04_model_training
python run_tests.py -m 06_utils
python run_tests.py -m integration

# åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„æµ‹è¯•æ¨¡å—
python run_tests.py -l

# è®¾ç½®è¾“å‡ºè¯¦ç»†ç¨‹åº¦
python run_tests.py -v 0  # é™é»˜æ¨¡å¼
python run_tests.py -v 1  # ç®€æ´æ¨¡å¼
python run_tests.py -v 2  # è¯¦ç»†æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨unittest

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m unittest discover tests

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
python -m unittest tests.test_01_basics

# è¿è¡Œå•ä¸ªæµ‹è¯•ç±»
python -m unittest tests.test_01_basics.TestTensorFlowBasics

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–¹æ³•
python -m unittest tests.test_01_basics.TestTensorFlowBasics.test_tensor_creation

# è¯¦ç»†è¾“å‡º
python -m unittest discover tests -v
```

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨pytest

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡ŒæŒ‡å®šæ–‡ä»¶
pytest tests/test_01_basics.py

# è¿è¡ŒæŒ‡å®šæµ‹è¯•ç±»
pytest tests/test_01_basics.py::TestTensorFlowBasics

# è¿è¡ŒæŒ‡å®šæµ‹è¯•æ–¹æ³•
pytest tests/test_01_basics.py::TestTensorFlowBasics::test_tensor_creation

# è¯¦ç»†è¾“å‡º
pytest -v

# æ˜¾ç¤ºæ‰“å°è¾“å‡º
pytest -s

# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
pytest --lf

# å¹¶è¡Œè¿è¡Œæµ‹è¯•ï¼ˆéœ€è¦å®‰è£…pytest-xdistï¼‰
pytest -n auto
```

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡

### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

```bash
# ä½¿ç”¨pytestç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=. --cov-report=html --cov-report=term

# ä½¿ç”¨coverage.py
coverage run -m unittest discover tests
coverage report
coverage html

# æŸ¥çœ‹HTMLæŠ¥å‘Š
# Windows:
start htmlcov/index.html
# macOS:
open htmlcov/index.html
# Linux:
xdg-open htmlcov/index.html
```

### è¦†ç›–ç‡ç›®æ ‡

- ğŸ¯ **ç›®æ ‡è¦†ç›–ç‡**: 80%ä»¥ä¸Š
- ğŸ“ˆ **å½“å‰è¦†ç›–ç‡**: è¿è¡Œæµ‹è¯•åæŸ¥çœ‹

### è¦†ç›–ç‡æŠ¥å‘Šå†…å®¹

- æ¯ä¸ªæ–‡ä»¶çš„è¦†ç›–ç‡ç™¾åˆ†æ¯”
- æœªè¦†ç›–çš„ä»£ç è¡Œ
- åˆ†æ”¯è¦†ç›–æƒ…å†µ
- æ€»ä½“è¦†ç›–ç‡ç»Ÿè®¡

## âœï¸ ç¼–å†™æµ‹è¯•

### æµ‹è¯•æ–‡ä»¶å‘½åè§„èŒƒ

```
test_<æ¨¡å—å>.py
```

### æµ‹è¯•ç±»å‘½åè§„èŒƒ

```python
class Test<åŠŸèƒ½å>(unittest.TestCase):
    """æµ‹è¯•æŸä¸ªåŠŸèƒ½çš„æè¿°"""
    pass
```

### æµ‹è¯•æ–¹æ³•å‘½åè§„èŒƒ

```python
def test_<å…·ä½“è¡Œä¸º>(self):
    """æµ‹è¯•å…·ä½“è¡Œä¸ºçš„æè¿°"""
    pass
```

### æµ‹è¯•æ¨¡æ¿

```python
"""
æµ‹è¯•æ¨¡å—æè¿°
"""

import unittest
import tensorflow as tf
import numpy as np
import sys
import os

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°è·¯å¾„
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))


class TestFeature(unittest.TestCase):
    """æµ‹è¯•æŸä¸ªåŠŸèƒ½"""

    def setUp(self):
        """æ¯ä¸ªæµ‹è¯•å‰çš„å‡†å¤‡å·¥ä½œ"""
        tf.random.set_seed(42)
        np.random.seed(42)

    def tearDown(self):
        """æ¯ä¸ªæµ‹è¯•åçš„æ¸…ç†å·¥ä½œ"""
        tf.keras.backend.clear_session()

    def test_specific_behavior(self):
        """æµ‹è¯•ç‰¹å®šè¡Œä¸º"""
        # 1. å‡†å¤‡æµ‹è¯•æ•°æ®
        input_data = tf.constant([1, 2, 3])

        # 2. æ‰§è¡Œæµ‹è¯•æ“ä½œ
        result = some_function(input_data)

        # 3. éªŒè¯ç»“æœ
        expected = tf.constant([2, 4, 6])
        self.assertEqual(result.shape, expected.shape)
        np.testing.assert_array_equal(result.numpy(), expected.numpy())


if __name__ == '__main__':
    unittest.main()
```

### å¸¸ç”¨æ–­è¨€

```python
# ç›¸ç­‰æ€§æ–­è¨€
self.assertEqual(a, b)
self.assertNotEqual(a, b)

# çœŸå€¼æ–­è¨€
self.assertTrue(condition)
self.assertFalse(condition)
self.assertIsNone(value)
self.assertIsNotNone(value)

# ç±»å‹æ–­è¨€
self.assertIsInstance(obj, class_type)

# æ•°å€¼æ–­è¨€
self.assertAlmostEqual(a, b, places=5)
self.assertGreater(a, b)
self.assertGreaterEqual(a, b)
self.assertLess(a, b)
self.assertLessEqual(a, b)

# å®¹å™¨æ–­è¨€
self.assertIn(item, container)
self.assertNotIn(item, container)

# NumPyæ•°ç»„æ–­è¨€
np.testing.assert_array_equal(a, b)
np.testing.assert_array_almost_equal(a, b, decimal=5)
np.testing.assert_allclose(a, b, rtol=1e-5)

# å¼‚å¸¸æ–­è¨€
with self.assertRaises(ValueError):
    function_that_raises()
```

### æµ‹è¯•æœ€ä½³å®è·µ

1. **ç‹¬ç«‹æ€§**: æ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œ
2. **å¯é‡å¤æ€§**: ä½¿ç”¨å›ºå®šçš„éšæœºç§å­
3. **æ¸…æ™°æ€§**: æµ‹è¯•åç§°åº”è¯¥æ¸…æ¥šæè¿°æµ‹è¯•å†…å®¹
4. **å®Œæ•´æ€§**: æµ‹è¯•åº”è¯¥è¦†ç›–æ­£å¸¸æƒ…å†µå’Œè¾¹ç•Œæƒ…å†µ
5. **å¿«é€Ÿæ€§**: å•å…ƒæµ‹è¯•åº”è¯¥å¿«é€Ÿæ‰§è¡Œ
6. **å¯ç»´æŠ¤æ€§**: æµ‹è¯•ä»£ç ä¹Ÿéœ€è¦è‰¯å¥½çš„ç»„ç»‡å’Œæ³¨é‡Š

## â“ å¸¸è§é—®é¢˜

### 1. æµ‹è¯•è¿è¡Œå¤±è´¥

**é—®é¢˜**: æµ‹è¯•æ— æ³•è¿è¡Œæˆ–å¯¼å…¥é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•
cd E:\IDEWorkplaces\PyCharm\TensorFlow2Demo

# æ£€æŸ¥Pythonè·¯å¾„
python -c "import sys; print('\n'.join(sys.path))"

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. TensorFlowç›¸å…³é”™è¯¯

**é—®é¢˜**: GPUå†…å­˜ä¸è¶³æˆ–CUDAé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```python
# åœ¨æµ‹è¯•æ–‡ä»¶å¼€å¤´æ·»åŠ 
import tensorflow as tf

# é™åˆ¶GPUå†…å­˜å¢é•¿
gpus = tf.config.list_physical_devices('GPU')
if gpus:
    for gpu in gpus:
        tf.config.experimental.set_memory_growth(gpu, True)
```

### 3. éšæœºæ€§å¯¼è‡´æµ‹è¯•ä¸ç¨³å®š

**é—®é¢˜**: æµ‹è¯•ç»“æœä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**:
```python
def setUp(self):
    """è®¾ç½®å›ºå®šçš„éšæœºç§å­"""
    tf.random.set_seed(42)
    np.random.seed(42)
    import random
    random.seed(42)
```

### 4. æµ‹è¯•è¿è¡Œç¼“æ…¢

**é—®é¢˜**: æµ‹è¯•æ‰§è¡Œæ—¶é—´è¿‡é•¿

**è§£å†³æ–¹æ¡ˆ**:
- å‡å°‘è®­ç»ƒepochæ•°é‡
- ä½¿ç”¨æ›´å°çš„æ•°æ®é›†
- ä½¿ç”¨æ›´ç®€å•çš„æ¨¡å‹
- å¹¶è¡Œè¿è¡Œæµ‹è¯•: `pytest -n auto`

### 5. è¦†ç›–ç‡æŠ¥å‘Šä¸å‡†ç¡®

**é—®é¢˜**: è¦†ç›–ç‡ç»Ÿè®¡ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…é™¤æ—§çš„è¦†ç›–ç‡æ•°æ®
coverage erase

# é‡æ–°è¿è¡Œæµ‹è¯•
coverage run -m unittest discover tests
coverage report
```

## ğŸ”„ æŒç»­é›†æˆ

### GitHub Actionsç¤ºä¾‹

åˆ›å»º `.github/workflows/tests.yml`:

```yaml
name: Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.8, 3.9, '3.10']

    steps:
    - uses: actions/checkout@v2

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run tests
      run: |
        python run_tests.py

    - name: Generate coverage report
      run: |
        pytest --cov=. --cov-report=xml

    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v2
```

## ğŸ“š å‚è€ƒèµ„æº

- [unittestå®˜æ–¹æ–‡æ¡£](https://docs.python.org/3/library/unittest.html)
- [pytestå®˜æ–¹æ–‡æ¡£](https://docs.pytest.org/)
- [Coverage.pyæ–‡æ¡£](https://coverage.readthedocs.io/)
- [TensorFlowæµ‹è¯•æŒ‡å—](https://www.tensorflow.org/guide/test)

## ğŸ“ å­¦ä¹ å»ºè®®

1. **ä»ç®€å•å¼€å§‹**: å…ˆè¿è¡Œç°æœ‰æµ‹è¯•ï¼Œç†è§£æµ‹è¯•ç»“æ„
2. **é˜…è¯»æµ‹è¯•ä»£ç **: æµ‹è¯•ä»£ç ä¹Ÿæ˜¯å¾ˆå¥½çš„å­¦ä¹ èµ„æº
3. **ç¼–å†™æµ‹è¯•**: ä¸ºæ–°åŠŸèƒ½ç¼–å†™æµ‹è¯•ï¼Œæé«˜ä»£ç è´¨é‡
4. **æŒç»­æ”¹è¿›**: å®šæœŸæ›´æ–°æµ‹è¯•ï¼Œä¿æŒæµ‹è¯•è¦†ç›–ç‡

---

**æ›´æ–°æ—¥æœŸ**: 2025-12-11
**ç‰ˆæœ¬**: 1.0.0

ç¥æµ‹è¯•é¡ºåˆ©ï¼ğŸ‰

